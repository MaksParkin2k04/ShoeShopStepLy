# Руководство по исправлению виртуального консультанта

## Проблемы, которые были исправлены:

### 1. Исправлен Chat.cshtml.cs
**Проблема:** Использовались хардкод URL для API вызовов
**Решение:** Переписан код для работы напрямую с базой данных через ApplicationContext

### 2. Добавлена таблица ChatMessages в Program.cs
**Проблема:** Таблица ChatMessages не создавалась автоматически
**Решение:** Добавлен код создания таблицы в Program.cs

### 3. Структура чата уже готова
- ✅ ChatController.cs - API для работы с сообщениями
- ✅ ChatMessage.cs - модель сообщения
- ✅ ApplicationContext.cs - DbSet для ChatMessages
- ✅ _Layout.cshtml - виджет чата на всех страницах
- ✅ chatbot.css - стили для чата
- ✅ Chat.cshtml - админ панель для ответов

## Как проверить работу чата:

### 1. Запустите приложение
```bash
cd "c:\Users\carro\Desktop\РАБОТА\StepLy\ShoeShop\ShoeShop"
dotnet run
```

### 2. Откройте тестовую страницу
Перейдите по адресу: `https://localhost:5001/test-chat.html`

### 3. Проверьте виджет чата
- Откройте главную страницу сайта
- В правом нижнем углу должен быть виджет "Консультант"
- Нажмите на него, чтобы открыть чат
- Отправьте тестовое сообщение

### 4. Проверьте админ панель
- Войдите как администратор
- Перейдите в раздел "Чат с клиентами"
- Там должны отображаться неотвеченные сообщения

## Возможные проблемы и решения:

### Проблема: Таблица ChatMessages не создается
**Решение:** Убедитесь, что приложение запускается и выполняется код инициализации в Program.cs

### Проблема: Виджет чата не отображается
**Решение:** Проверьте, что файл chatbot.css подключен в _Layout.cshtml

### Проблема: API возвращает ошибки
**Решение:** 
1. Проверьте строку подключения к базе данных в appsettings.json
2. Убедитесь, что база данных доступна
3. Проверьте логи приложения

### Проблема: Сообщения не сохраняются
**Решение:** Проверьте, что таблица ChatMessages создана в базе данных

## Функциональность чата:

### Для пользователей:
- Виджет чата в правом нижнем углу
- Автоматические ответы на частые вопросы
- Сохранение истории сообщений
- Уведомления о передаче консультанту

### Для администраторов:
- Просмотр неотвеченных сообщений
- Ответы клиентам через админ панель
- История всех сообщений

## API эндпоинты:

- `POST /api/chat/send` - отправка сообщения
- `GET /api/chat/unread` - получение неотвеченных сообщений
- `POST /api/chat/respond` - ответ на сообщение
- `GET /api/chat/history/{userId}` - история сообщений пользователя

## Автоматические ответы бота:

Бот автоматически отвечает на вопросы о:
- Размерах обуви
- Доставке
- Оплате
- Скидках и акциях
- Возврате и обмене
- Качестве товаров
- Контактах

Если вопрос не распознан, сообщение передается консультанту.