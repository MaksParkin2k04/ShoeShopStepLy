@page
@model ShoeShop.Pages.Admin.AnalyticsModel
@{
    ViewData["Title"] = "Аналитика сайта";
}

<div class="analytics-page">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-chart-bar me-2"></i>Аналитика сайта</h2>
        <a asp-page="/Admin/Index" class="btn btn-secondary">
            <i class="fas fa-arrow-left me-1"></i>Назад
        </a>
    </div>

    <div class="row g-4">
        <div class="col-md-3">
            <div class="analytics-card">
                <div class="analytics-icon">
                    <i class="fas fa-eye text-primary"></i>
                </div>
                <div class="analytics-content">
                    <h3>@Model.MetrikaStats.Visits</h3>
                    <p>Визиты</p>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="analytics-card">
                <div class="analytics-icon">
                    <i class="fas fa-file-alt text-success"></i>
                </div>
                <div class="analytics-content">
                    <h3>@Model.MetrikaStats.PageViews</h3>
                    <p>Просмотры</p>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="analytics-card">
                <div class="analytics-icon">
                    <i class="fas fa-users text-info"></i>
                </div>
                <div class="analytics-content">
                    <h3>@Model.MetrikaStats.Users</h3>
                    <p>Пользователи</p>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="analytics-card">
                <div class="analytics-icon">
                    <i class="fas fa-percentage text-warning"></i>
                </div>
                <div class="analytics-content">
                    <h3>@Model.MetrikaStats.BounceRate.ToString("F1")%</h3>
                    <p>Отказы</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4 mt-2">
        <div class="col-md-3">
            <div class="analytics-card">
                <div class="analytics-icon">
                    <i class="fas fa-clock text-secondary"></i>
                </div>
                <div class="analytics-content">
                    <h3>@((int)Model.MetrikaStats.AvgVisitDuration)с</h3>
                    <p>Ср. время на сайте</p>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="analytics-card">
                <div class="analytics-icon">
                    <i class="fas fa-user-plus text-success"></i>
                </div>
                <div class="analytics-content">
                    <h3>@Model.MetrikaStats.NewUsers</h3>
                    <p>Новые пользователи</p>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="analytics-card">
                <div class="analytics-icon">
                    <i class="fas fa-mobile-alt text-primary"></i>
                </div>
                <div class="analytics-content">
                    <h3>@Model.MetrikaStats.MobileUsers</h3>
                    <p>Мобильные</p>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="analytics-card">
                <div class="analytics-icon">
                    <i class="fas fa-desktop text-info"></i>
                </div>
                <div class="analytics-content">
                    <h3>@Model.MetrikaStats.DesktopUsers</h3>
                    <p>Десктоп</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4 mt-2">
        <div class="col-md-3">
            <div class="analytics-card">
                <div class="analytics-icon">
                    <i class="fas fa-tablet-alt text-warning"></i>
                </div>
                <div class="analytics-content">
                    <h3>@Model.MetrikaStats.TabletUsers</h3>
                    <p>Планшеты</p>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="analytics-card">
                <div class="analytics-icon">
                    <i class="fas fa-redo text-primary"></i>
                </div>
                <div class="analytics-content">
                    <h3>@Model.MetrikaStats.ReturningUsers</h3>
                    <p>Возвращающиеся</p>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="analytics-card">
                <div class="analytics-icon">
                    <i class="fas fa-bullseye text-success"></i>
                </div>
                <div class="analytics-content">
                    <h3>@Model.MetrikaStats.ConversionRate.ToString("F1")%</h3>
                    <p>Конверсия</p>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="analytics-card">
                <div class="analytics-icon">
                    <i class="fas fa-trophy text-warning"></i>
                </div>
                <div class="analytics-content">
                    <h3>@Model.MetrikaStats.Goals</h3>
                    <p>Цели</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4 mt-2">
        <div class="col-md-3">
            <div class="analytics-card">
                <div class="analytics-icon">
                    <i class="fas fa-layer-group text-info"></i>
                </div>
                <div class="analytics-content">
                    <h3>@Model.MetrikaStats.AvgPageDepth.ToString("F1")</h3>
                    <p>Глубина просмотра</p>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="analytics-card">
                <div class="analytics-icon">
                    <i class="fas fa-play text-success"></i>
                </div>
                <div class="analytics-content">
                    <h3>@Model.MetrikaStats.TotalSessions</h3>
                    <p>Сессии</p>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="analytics-card">
                <div class="analytics-icon">
                    <i class="fas fa-tachometer-alt text-primary"></i>
                </div>
                <div class="analytics-content">
                    <h3>@Model.MetrikaStats.PageLoadTime.ToString("F1")с</h3>
                    <p>Скорость загрузки</p>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="analytics-card">
                <div class="analytics-icon">
                    <i class="fas fa-exclamation-triangle text-danger"></i>
                </div>
                <div class="analytics-content">
                    <h3>@Model.MetrikaStats.ErrorPages</h3>
                    <p>Ошибки 404</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-6">
            <div class="analytics-table">
                <h5><i class="fas fa-chart-line me-2"></i>Популярные страницы</h5>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Страница</th>
                            <th>Просмотры</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var topPage in Model.MetrikaStats.TopPages)
                        {
                            <tr>
                                <td>@topPage.Url</td>
                                <td><span class="badge bg-primary">@topPage.Views</span></td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <div class="col-md-6">
            <div class="analytics-table">
                <h5><i class="fas fa-share-alt me-2"></i>Источники трафика</h5>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Источник</th>
                            <th>Пользователи</th>
                            <th>%</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var source in Model.MetrikaStats.TrafficSources)
                        {
                            <tr>
                                <td>@source.Source</td>
                                <td><span class="badge bg-success">@source.Users</span></td>
                                <td>@source.Percentage.ToString("F1")%</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-6">
            <div class="analytics-table">
                <h5><i class="fas fa-globe me-2"></i>География пользователей</h5>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Страна</th>
                            <th>Пользователи</th>
                            <th>%</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var country in Model.MetrikaStats.TopCountries)
                        {
                            <tr>
                                <td>@country.Country</td>
                                <td><span class="badge bg-info">@country.Users</span></td>
                                <td>@country.Percentage.ToString("F1")%</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <div class="col-md-6">
            <div class="analytics-table">
                <h5><i class="fas fa-browser me-2"></i>Браузеры</h5>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Браузер</th>
                            <th>Пользователи</th>
                            <th>%</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var browser in Model.MetrikaStats.TopBrowsers)
                        {
                            <tr>
                                <td>@browser.Browser</td>
                                <td><span class="badge bg-warning">@browser.Users</span></td>
                                <td>@browser.Percentage.ToString("F1")%</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-12">
            <div class="analytics-table">
                <h5><i class="fas fa-chart-area me-2"></i>Почасовая активность</h5>
                <div class="hourly-chart">
                    @foreach (var hour in Model.MetrikaStats.HourlyData)
                    {
                        <div class="hour-bar">
                            <div class="bar" style="height: @(hour.Visits / 2)px;"></div>
                            <div class="hour-label">@hour.Hour:00</div>
                            <div class="visits-count">@hour.Visits</div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-6">
            <div class="analytics-table">
                <h5><i class="fas fa-search me-2"></i>Популярные запросы</h5>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Запрос</th>
                            <th>Количество</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var query in Model.MetrikaStats.TopSearchQueries)
                        {
                            <tr>
                                <td>@query.Query</td>
                                <td><span class="badge bg-secondary">@query.Count</span></td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <div class="col-md-6">
            <div class="analytics-table">
                <h5><i class="fas fa-sign-out-alt me-2"></i>Страницы выхода</h5>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Страница</th>
                            <th>Выходы</th>
                            <th>% выходов</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var exitPage in Model.MetrikaStats.TopExitPages)
                        {
                            <tr>
                                <td>@exitPage.Url</td>
                                <td><span class="badge bg-danger">@exitPage.Exits</span></td>
                                <td>@exitPage.ExitRate.ToString("F1")%</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-12">
            <div class="analytics-info">
                <h5>Период: @Model.MetrikaStats.Period</h5>
                <p class="text-muted">Данные предоставлены Яндекс.Метрикой</p>
            </div>
        </div>
    </div>
</div>

<style>
.analytics-card {
    background: white;
    border-radius: 10px;
    padding: 30px 20px;
    text-align: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    height: 100%;
}

.analytics-icon {
    font-size: 3rem;
    margin-bottom: 20px;
}

.analytics-content h3 {
    font-size: 2.5rem;
    font-weight: bold;
    margin-bottom: 10px;
    color: #333;
}

.analytics-content p {
    color: #666;
    margin: 0;
    font-size: 1.1rem;
}

.analytics-info {
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.analytics-table {
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    height: 100%;
}

.analytics-table h5 {
    color: #333;
    margin-bottom: 20px;
    font-weight: 600;
}

.analytics-table .table {
    margin-bottom: 0;
}

.analytics-table .badge {
    font-size: 0.9rem;
}

.hourly-chart {
    display: flex;
    align-items: end;
    justify-content: space-between;
    height: 200px;
    padding: 20px 0;
}

.hour-bar {
    display: flex;
    flex-direction: column;
    align-items: center;
    flex: 1;
}

.bar {
    background: linear-gradient(to top, #007bff, #0056b3);
    width: 20px;
    border-radius: 3px 3px 0 0;
    margin-bottom: 5px;
    min-height: 10px;
}

.hour-label {
    font-size: 0.8rem;
    color: #666;
    margin-top: 5px;
}

.visits-count {
    font-size: 0.7rem;
    color: #999;
    font-weight: bold;
}
</style>