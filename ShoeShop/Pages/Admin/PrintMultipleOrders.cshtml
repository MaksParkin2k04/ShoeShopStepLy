@page
@model ShoeShop.Pages.Admin.PrintMultipleOrdersModel
@{
    ViewData["Title"] = "–ü–µ—á–∞—Ç—å —ç—Ç–∏–∫–µ—Ç–æ–∫";
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>–ü–µ—á–∞—Ç—å —ç—Ç–∏–∫–µ—Ç–æ–∫ –∑–∞–∫–∞–∑–æ–≤</title>
    <link rel="stylesheet" href="~/styles/label-print.css" />
    <style>
        .labels-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            padding: 20px;
        }
        
        .label {
            width: 300px;
            margin-bottom: 20px;
            break-inside: avoid;
            page-break-inside: avoid;
        }
        
        @@media print {
            .labels-container {
                display: block;
            }
            
            .label {
                width: 100%;
                max-width: 300px;
                margin: 0 auto 20px;
            }
            
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="no-print" style="text-align: center; margin: 20px;">
        <p>–ù–∞–π–¥–µ–Ω–æ –∑–∞–∫–∞–∑–æ–≤: @Model.Orders.Count</p>
        <button onclick="window.print()" class="btn btn-primary">–ü–µ—á–∞—Ç—å –≤—Å–µ—Ö —ç—Ç–∏–∫–µ—Ç–æ–∫</button>
        <button onclick="window.close()" class="btn btn-secondary">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <div class="labels-container">
        @foreach (var order in Model.Orders)
        {
            <div class="label">
                <div class="header">
                    <div class="company-name">StepLy</div>
                    <div class="order-number">–ó–∞–∫–∞–∑ ‚Ññ@order.Id</div>
                    <div class="payment-status">
                        @if (order.PaymentDate.HasValue || order.Status == ShoeShop.Models.OrderStatus.Paid)
                        {
                            <span class="paid">‚úì –û–ü–õ–ê–ß–ï–ù–û</span>
                        }
                        else
                        {
                            <span class="unpaid">‚úó –ù–ï –û–ü–õ–ê–ß–ï–ù–û</span>
                        }
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">–ü–æ–ª—É—á–∞—Ç–µ–ª—å:</div>
                    <div class="recipient-info">
                        <div><strong>@order.Recipient?.Name</strong></div>
                        <div>@order.Recipient?.Phone</div>
                        <div>@order.Recipient?.City</div>
                        <div>@order.Recipient?.Street, @order.Recipient?.House</div>
                        @if (!string.IsNullOrEmpty(order.Recipient?.Apartment))
                        {
                            <div>–∫–≤. @order.Recipient?.Apartment</div>
                        }
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">–¢–æ–≤–∞—Ä—ã:</div>
                    <div class="items-list">
                        @foreach (var item in order.OrderDetails ?? Enumerable.Empty<ShoeShop.Models.OrderDetail>())
                        {
                            <div class="item">
                                @item.Name (—Ä–∞–∑–º–µ—Ä @item.Size) - @item.Price‚ÇΩ
                            </div>
                        }
                    </div>
                </div>

                <div class="total">
                    –ò—Ç–æ–≥–æ: @(order.OrderDetails?.Sum(x => x.Price) ?? 0)‚ÇΩ
                </div>

                <div class="section">
                    <div class="section-title">–î–æ—Å—Ç–∞–≤–∫–∞:</div>
                    <div style="font-size: 12px;">
                        @switch (order.DeliveryType)
                        {
                            case ShoeShop.Models.DeliveryType.Courier:
                                <div>üöö –ö—É—Ä—å–µ—Ä—Å–∫–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞</div>
                                break;
                            case ShoeShop.Models.DeliveryType.Pickup:
                                <div>üè¢ –°–∞–º–æ–≤—ã–≤–æ–∑ –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞</div>
                                break;
                            case ShoeShop.Models.DeliveryType.RussianPost:
                                <div>üìÆ –ü–æ—á—Ç–∞ –†–æ—Å—Å–∏–∏</div>
                                break;
                            case ShoeShop.Models.DeliveryType.CDEK:
                                <div>üì¶ –°–î–≠–ö</div>
                                break;
                            case ShoeShop.Models.DeliveryType.Boxberry:
                                <div>üì¶ Boxberry</div>
                                break;
                        }
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-title">–û–ø–ª–∞—Ç–∞:</div>
                    <div style="font-size: 12px;">
                        @if (order.PaymentType == ShoeShop.Models.PaymentType.Online)
                        {
                            <div>–û–Ω–ª–∞–π–Ω –æ–ø–ª–∞—Ç–∞</div>
                            @if (order.PaymentDate.HasValue)
                            {
                                <div>–û–ø–ª–∞—á–µ–Ω–æ: @order.PaymentDate.Value.ToString("dd.MM.yyyy HH:mm")</div>
                            }
                            else
                            {
                                <div>–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã</div>
                            }
                        }
                        else
                        {
                            <div>–û–ø–ª–∞—Ç–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏</div>
                        }
                    </div>
                </div>

                <div class="section" style="margin-top: 15px; font-size: 10px;">
                    <div>–î–∞—Ç–∞: @order.CreatedDate.ToString("dd.MM.yyyy HH:mm")</div>
                    @if (!string.IsNullOrEmpty(order.Coment))
                    {
                        <div>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: @order.Coment</div>
                    }
                </div>

                @if (!string.IsNullOrEmpty(Model.GetQRCodeForOrder(order.Id)))
                {
                    <div class="qr-section">
                        <div class="section-title">–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞:</div>
                        <img src="data:image/png;base64,@Model.GetQRCodeForOrder(order.Id)" alt="QR –∫–æ–¥ –∑–∞–∫–∞–∑–∞" class="qr-code" />
                        <div style="font-size: 8px; text-align: center; margin-top: 5px;">–°–∫–∞–Ω–∏—Ä—É–π—Ç–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è</div>
                    </div>
                }
            </div>
        }
    </div>

    <script>
        window.onload = function() {
            setTimeout(function() {
                window.print();
            }, 500);
        };
    </script>
</body>
</html>