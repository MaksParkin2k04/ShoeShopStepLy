@page
@model ShoeShop.Pages.Admin.TelegramManagementModel
@using ShoeShop.Models
@{
    ViewData["Title"] = "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Telegram";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <h2>üì± –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Telegram –±–æ—Ç–æ–º</h2>
            
            <div class="row mt-4">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="col-md-3">
                    <div class="card bg-primary text-white">
                        <div class="card-body">
                            <h5>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h5>
                            <h3>@Model.TotalUsers</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-success text-white">
                        <div class="card-body">
                            <h5>üì¶ –ó–∞–∫–∞–∑—ã –∏–∑ Telegram</h5>
                            <h3>@Model.TelegramOrders</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-info text-white">
                        <div class="card-body">
                            <h5>üí∞ –°—É–º–º–∞ (Telegram)</h5>
                            <h3>@Model.TelegramRevenue.ToString("N0") ‚ÇΩ</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-warning text-white">
                        <div class="card-body">
                            <h5>üìä –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–µ–≥–æ–¥–Ω—è</h5>
                            <h3>@Model.TodayActivity</h3>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ Telegram -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ Telegram</h5>
                </div>
                <div class="card-body">
                    @if (Model.TelegramUsers.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>–ò–º—è</th>
                                        <th>Username</th>
                                        <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                        <th>–ó–∞–∫–∞–∑–æ–≤</th>
                                        <th>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</th>
                                        <th>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var user in Model.TelegramUsers)
                                    {
                                        <tr>
                                            <td>@user.TelegramId</td>
                                            <td>@user.GetFullName()</td>
                                            <td>@@@user.Username</td>
                                            <td>@user.Phone</td>
                                            <td>@user.Orders.Count</td>
                                            <td>@user.CreatedDate.ToString("dd.MM.yyyy")</td>
                                            <td>@user.LastActivity.ToString("dd.MM.yyyy HH:mm")</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <p class="text-muted">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ Telegram –ø–æ–∫–∞ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã</p>
                    }
                </div>
            </div>
            
            <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã –∏–∑ Telegram -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5>üì¶ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã –∏–∑ Telegram</h5>
                </div>
                <div class="card-body">
                    @if (Model.RecentTelegramOrders.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>–ù–æ–º–µ—Ä</th>
                                        <th>–î–∞—Ç–∞</th>
                                        <th>–ö–ª–∏–µ–Ω—Ç</th>
                                        <th>–°—É–º–º–∞</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var order in Model.RecentTelegramOrders)
                                    {
                                        <tr>
                                            <td>@order.OrderNumber</td>
                                            <td>@order.CreatedDate.ToString("dd.MM.yyyy HH:mm")</td>
                                            <td>@order.Recipient?.Name</td>
                                            <td>@order.OrderDetails?.Sum(d => d.Price).ToString("N0") ‚ÇΩ</td>
                                            <td>
                                                <span class="badge @GetStatusBadgeClass(order.Status)">
                                                    @GetStatusText(order.Status)
                                                </span>
                                            </td>
                                            <td>
                                                <a href="/Admin/Orders/Details/@order.Id" class="btn btn-sm btn-outline-primary">
                                                    –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                                </a>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <p class="text-muted">–ó–∞–∫–∞–∑—ã –∏–∑ Telegram –ø–æ–∫–∞ –Ω–µ –ø–æ—Å—Ç—É–ø–∞–ª–∏</p>
                    }
                </div>
            </div>
            
            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞ -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>ü§ñ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ</h6>
                            <p><strong>–¢–æ–∫–µ–Ω:</strong> 8468206640:AAF***sx1U</p>
                            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="badge bg-success">–ê–∫—Ç–∏–≤–µ–Ω</span></p>
                            <p><strong>–†–µ–∂–∏–º:</strong> Long Polling</p>
                        </div>
                        <div class="col-md-6">
                            <h6>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã</h6>
                            <p><strong>–ó–∞–ø—É—â–µ–Ω:</strong> @DateTime.Now.ToString("dd.MM.yyyy HH:mm")</p>
                            <p><strong>–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π:</strong> @Model.TotalUsers * 5</p>
                            <p><strong>–û—à–∏–±–æ–∫:</strong> 0</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@functions {
    private string GetStatusBadgeClass(OrderStatus status)
    {
        return status switch
        {
            OrderStatus.Created => "bg-secondary",
            OrderStatus.Paid => "bg-success",
            OrderStatus.Processing => "bg-warning",
            OrderStatus.Shipped => "bg-info",
            OrderStatus.Completed => "bg-success",
            OrderStatus.Canceled => "bg-danger",
            _ => "bg-secondary"
        };
    }
    
    private string GetStatusText(OrderStatus status)
    {
        return status switch
        {
            OrderStatus.Created => "–°–æ–∑–¥–∞–Ω",
            OrderStatus.Paid => "–û–ø–ª–∞—á–µ–Ω",
            OrderStatus.Processing => "–í –æ–±—Ä–∞–±–æ—Ç–∫–µ",
            OrderStatus.AwaitingShipment => "–û–∂–∏–¥–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏",
            OrderStatus.Shipped => "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω",
            OrderStatus.InTransit => "–í –ø—É—Ç–∏",
            OrderStatus.Arrived => "–ü—Ä–∏–±—ã–ª",
            OrderStatus.ReadyForPickup => "–ì–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ",
            OrderStatus.Completed => "–í—ã–ø–æ–ª–Ω–µ–Ω",
            OrderStatus.Returned => "–í–æ–∑–≤—Ä–∞—â–µ–Ω",
            OrderStatus.Canceled => "–û—Ç–º–µ–Ω–µ–Ω",
            _ => "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"
        };
    }
}