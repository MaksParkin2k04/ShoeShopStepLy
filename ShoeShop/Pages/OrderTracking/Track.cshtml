@page "/OrderTracking/Track/{orderId}"
@model ShoeShop.Pages.OrderTracking.TrackModel
@{
    ViewData["Title"] = "–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞";
}

<div class="container mt-4">
    @if (Model.Order != null)
    {
        <div class="row">
            <div class="col-md-8 mx-auto">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">üì¶ –ó–∞–∫–∞–∑ ‚Ññ@Model.Order.Id</h4>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <h6>–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞:</h6>
                                <span class="badge bg-@(Model.Order.Status == ShoeShop.Models.OrderStatus.Paid ? "success" : "warning") fs-6">
                                    @Model.Order.Status
                                </span>
                            </div>
                            <div class="col-md-6">
                                <h6>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</h6>
                                <p>@Model.Order.CreatedDate.ToString("dd.MM.yyyy HH:mm")</p>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <h6>–ü–æ–ª—É—á–∞—Ç–µ–ª—å:</h6>
                                <p class="mb-1"><strong>@Model.Order.Recipient.Name</strong></p>
                                <p class="mb-1">üìû @Model.Order.Recipient.Phone</p>
                                <p class="mb-0">üìç @Model.Order.Recipient.City, @Model.Order.Recipient.Street @Model.Order.Recipient.House</p>
                            </div>
                            <div class="col-md-6">
                                <h6>–î–æ—Å—Ç–∞–≤–∫–∞:</h6>
                                @switch (Model.Order.DeliveryType)
                                {
                                    case ShoeShop.Models.DeliveryType.Courier:
                                        <p class="mb-0">üöö –ö—É—Ä—å–µ—Ä—Å–∫–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞</p>
                                        break;
                                    case ShoeShop.Models.DeliveryType.Pickup:
                                        <p class="mb-0">üè¢ –°–∞–º–æ–≤—ã–≤–æ–∑ –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞</p>
                                        break;
                                    case ShoeShop.Models.DeliveryType.RussianPost:
                                        <p class="mb-0">üìÆ –ü–æ—á—Ç–∞ –†–æ—Å—Å–∏–∏</p>
                                        break;
                                    case ShoeShop.Models.DeliveryType.CDEK:
                                        <p class="mb-0">üì¶ –°–î–≠–ö</p>
                                        break;
                                    case ShoeShop.Models.DeliveryType.Boxberry:
                                        <p class="mb-0">üì¶ Boxberry</p>
                                        break;
                                }
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <h6>–û–ø–ª–∞—Ç–∞:</h6>
                                @if (Model.Order.PaymentType == ShoeShop.Models.PaymentType.Online)
                                {
                                    <p class="mb-1">üí≥ –û–Ω–ª–∞–π–Ω –æ–ø–ª–∞—Ç–∞</p>
                                    @if (Model.Order.PaymentDate.HasValue)
                                    {
                                        <p class="text-success mb-0">‚úÖ –û–ø–ª–∞—á–µ–Ω–æ @Model.Order.PaymentDate.Value.ToString("dd.MM.yyyy HH:mm")</p>
                                    }
                                    else
                                    {
                                        <p class="text-warning mb-0">‚è≥ –û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã</p>
                                    }
                                }
                                else
                                {
                                    <p class="mb-0">üí∞ –û–ø–ª–∞—Ç–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏</p>
                                }
                            </div>
                        </div>

                        <h6>–¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ:</h6>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>–¢–æ–≤–∞—Ä</th>
                                        <th>–†–∞–∑–º–µ—Ä</th>
                                        <th class="text-end">–¶–µ–Ω–∞</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.Order.OrderDetails)
                                    {
                                        <tr>
                                            <td>@item.Name</td>
                                            <td>@item.Size</td>
                                            <td class="text-end">@item.Price‚ÇΩ</td>
                                        </tr>
                                    }
                                </tbody>
                                <tfoot>
                                    <tr class="fw-bold">
                                        <td colspan="2">–ò—Ç–æ–≥–æ:</td>
                                        <td class="text-end">@Model.Order.OrderDetails.Sum(x => x.Price)‚ÇΩ</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>

                        @if (!string.IsNullOrEmpty(Model.Order.Coment))
                        {
                            <div class="mt-3">
                                <h6>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</h6>
                                <p class="text-muted">@Model.Order.Coment</p>
                            </div>
                        }
                        
                        @if (User.IsInRole("Admin"))
                        {
                            <div class="mt-4 pt-3 border-top">
                                <h6>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:</h6>
                                <form asp-page="/OrderTracking/Track" asp-page-handler="UpdateStatus" method="post" class="d-inline">
                                    <input type="hidden" name="orderId" value="@Model.Order.Id" />
                                    <select name="status" class="form-select form-select-sm d-inline-block" style="width: auto;" onchange="this.form.submit()">
                                        @foreach (var status in Enum.GetValues<ShoeShop.Models.OrderStatus>())
                                        {
                                            <option value="@status" selected="@(status == Model.Order.Status)">
                                                @switch (status)
                                                {
                                                    case ShoeShop.Models.OrderStatus.Created: <text>–ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω</text> break;
                                                    case ShoeShop.Models.OrderStatus.Paid: <text>–û–ø–ª–∞—á–µ–Ω</text> break;
                                                    case ShoeShop.Models.OrderStatus.Processing: <text>–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</text> break;
                                                    case ShoeShop.Models.OrderStatus.AwaitingShipment: <text>–û–∂–∏–¥–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</text> break;
                                                    case ShoeShop.Models.OrderStatus.Shipped: <text>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω</text> break;
                                                    case ShoeShop.Models.OrderStatus.InTransit: <text>–í –ø—É—Ç–∏</text> break;
                                                    case ShoeShop.Models.OrderStatus.Arrived: <text>–ü—Ä–∏–±—ã–ª</text> break;
                                                    case ShoeShop.Models.OrderStatus.ReadyForPickup: <text>–ì–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ</text> break;
                                                    case ShoeShop.Models.OrderStatus.Completed: <text>–í—ã–ø–æ–ª–Ω–µ–Ω</text> break;
                                                    case ShoeShop.Models.OrderStatus.Returned: <text>–í–æ–∑–≤—Ä–∞—â–µ–Ω</text> break;
                                                    case ShoeShop.Models.OrderStatus.Canceled: <text>–û—Ç–º–µ–Ω–µ–Ω</text> break;
                                                }
                                            </option>
                                        }
                                    </select>
                                </form>
                                <a asp-page="/Admin/OrderDetail" asp-route-id="@Model.Order.Id" class="btn btn-primary btn-sm">
                                    <i class="fas fa-edit me-1"></i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑
                                </a>
                                <a asp-page="/OrderLabel" asp-route-orderId="@Model.Order.Id" class="btn btn-success btn-sm" target="_blank">
                                    <i class="fas fa-print me-1"></i>–ü–µ—á–∞—Ç—å —ç—Ç–∏–∫–µ—Ç–∫–∏
                                </a>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="alert alert-danger">
            <h4>–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω</h4>
            <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Å—Å—ã–ª–∫–∏ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏.</p>
        </div>
    }
</div>