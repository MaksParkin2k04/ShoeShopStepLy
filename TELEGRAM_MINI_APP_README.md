# Telegram Mini App для ShoeShop

## Описание
Telegram Mini App предоставляет клиентам возможность просматривать каталог обуви и оформлять заказы прямо в Telegram.

## Функционал
- Просмотр каталога товаров
- Фильтрация по категориям (мужская, женская, детская обувь)
- Добавление товаров в корзину
- Оформление заказов
- Интеграция с основной системой заказов

## Настройка Telegram Mini App

### 1. Создание бота
1. Откройте @BotFather в Telegram
2. Отправьте команду `/newbot`
3. Введите название бота: `StepLy Shop Bot`
4. Введите username бота: `steply_shop_bot` (должен быть уникальным)
5. Сохраните полученный токен бота

### 2. Создание Mini App
1. В @BotFather отправьте команду `/newapp`
2. Выберите созданного бота
3. Введите название приложения: `StepLy Shop`
4. Введите описание: `Магазин качественной обуви StepLy`
5. Загрузите иконку приложения (512x512px, PNG/JPG)
6. Введите URL приложения: `https://yourdomain.com/telegram-app`
7. Выберите "Inline keyboard"

### 3. Настройка веб-хука (опционально)
Для получения уведомлений о действиях пользователей:
```bash
curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook" \
     -H "Content-Type: application/json" \
     -d '{"url": "https://yourdomain.com/api/telegram/webhook"}'
```

## Структура файлов

```
wwwroot/telegram-app/
├── index.html          # Главная страница приложения
├── styles.css          # Стили с поддержкой Telegram тем
└── app.js             # JavaScript логика приложения
```

## API Endpoints

### GET /api/products
Получение списка товаров для каталога
```json
[
  {
    "id": "guid",
    "name": "Название товара",
    "price": 5990,
    "originalPrice": 7990,
    "image": "/images/products/image.jpg",
    "category": "men"
  }
]
```

### POST /api/orders
Создание заказа из Telegram
```json
{
  "items": [
    {
      "id": "guid",
      "name": "Название товара",
      "price": 5990,
      "quantity": 1,
      "size": 42
    }
  ],
  "customer": {
    "name": "Имя клиента",
    "phone": "+7 (999) 123-45-67",
    "address": "Город, Улица, Дом, Квартира",
    "telegramId": 123456789
  },
  "total": 5990
}
```

### GET /api/orders/{telegramId}
Получение заказов пользователя по Telegram ID

## Особенности реализации

### Интеграция с Telegram WebApp API
- Использование `window.Telegram.WebApp` для доступа к функциям Telegram
- Поддержка тем Telegram через CSS переменные
- Использование MainButton для основных действий
- Автоматическое расширение приложения на весь экран

### Адаптивный дизайн
- Оптимизация для мобильных устройств
- Поддержка различных размеров экранов
- Удобная навигация через нижнее меню

### Локальное хранение
- Сохранение корзины в localStorage
- Восстановление состояния при перезагрузке

## Администрирование

### Страница настройки
Доступна по адресу `/Admin/TelegramBot` и содержит:
- Ссылку для настройки Mini App
- Инструкции по настройке
- Статистику заказов из Telegram
- Список последних заказов

### Статистика
- Общее количество заказов из Telegram
- Общая сумма заказов
- Количество уникальных клиентов
- Заказы за сегодня

## Безопасность

### Валидация данных Telegram
Рекомендуется добавить проверку подлинности данных от Telegram:
```csharp
public bool ValidateTelegramData(string initData, string botToken) {
    // Реализация проверки hash от Telegram
    // https://core.telegram.org/bots/webapps#validating-data-received-via-the-web-app
}
```

### Ограничения
- Заказы создаются только с базовой информацией
- Размеры товаров устанавливаются по умолчанию (40)
- Требуется ручная обработка заказов администратором

## Развитие функционала

### Планируемые улучшения
1. Выбор размеров товаров
2. Система уведомлений о статусе заказа
3. История заказов пользователя
4. Интеграция с платежными системами
5. Система отзывов и рейтингов
6. Поиск товаров
7. Избранные товары

### Интеграция с VK Mini App
Архитектура позволяет легко адаптировать приложение для VK:
- Замена Telegram WebApp API на VK Bridge
- Адаптация стилей под VK дизайн-систему
- Настройка аутентификации через VK ID